#!/usr/bin/env sh

set -e

trap 'trap - TERM; kill 0' INT TERM QUIT EXIT

# get screen size
IFS='x' read w h <<< "$(xrandr | awk '/\*/ {print $1}')"

. wmconfig

[ -e "$PANEL_FIFO" ] && rm "$PANEL_FIFO"
mkfifo "$PANEL_FIFO"

bspc control --subscribe > "$PANEL_FIFO" &
echo "T" > "$PANEL_FIFO" &
# conky > "$PANEL_FIFO" &


#while :; do
#    mkbar # cat a basic shell script
#done \
cat "$PANEL_FIFO" \
    | fifo2bar \
    | lemonbar \
        -f "$FONT2"\
        -F "$COLOR_FG"\
        -B "$COLOR_BG"\
        -g "$PANEL_GEOMETRY"\
        -u "$LINEHEIGHT" &
wait

